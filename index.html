<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Site Sandbox Viewer</title>
<style>
body { font-family: system-ui, sans-serif; margin:0; padding:12px; background:#f7f7fb; }
header { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
select, button { padding:6px 10px; font-size:14px; }
#frameWrap { border:1px solid #ddd; height:75vh; position:relative; background:white; }
iframe { width:100%; height:100%; border:0; display:block; }
.message { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:16px; text-align:center; color:#666; }
</style>
</head>
<body>

<header>
<label for="url">Choose site:</label>
<select id="url">
  <option value="compendium">compendiumofeverything.org</option>
  <option value="example">example.com</option>
</select>
<button id="load">Load</button>
<button id="open">Open in new tab</button>
</header>

<div id="frameWrap">
  <div id="blockedMsg" class="message" style="display:none;">
    This site could not be embedded.<br>Click 'Open in new tab' to view it directly.
  </div>
  <iframe id="viewer"></iframe>
</div>

<script>
const sel = document.getElementById('url');
const btn = document.getElementById('load');
const openBtn = document.getElementById('open');
const iframe = document.getElementById('viewer');
const blockedMsg = document.getElementById('blockedMsg');

function loadSite(key) {
  blockedMsg.style.display = 'none';
  iframe.src = `/api/proxy?url=${key}`;

  iframe.onload = () => {
    try {
      if (iframe.contentWindow.location.href === 'about:blank') {
        blockedMsg.style.display = 'flex';
      }
    } catch(e) {
      // cross-origin frames are usually fine
      blockedMsg.style.display = 'none';
    }
  };
}

// initial load
loadSite(sel.value);

btn.addEventListener('click', () => loadSite(sel.value));

openBtn.addEventListener('click', () => {
  const key = sel.value;
  const urlMap = {
    'compendium': 'https://compendiumofeverything.org',
    'example': 'https://example.com'
  };
  window.open(urlMap[key], '_blank', 'noopener');
});
</script>

</body>
</html>
