<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Site Sandbox Viewer</title>
<style>
body { font-family: system-ui, sans-serif; margin:0; padding:12px; background:#f7f7fb; }
header { display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap; }
select, input, button { padding:6px 10px; font-size:14px; }
#frameWrap { border:1px solid #ddd; height:75vh; position:relative; background:white; flex:1 1 100%; }
iframe { width:100%; height:100%; border:0; display:block; }
.message { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:16px; text-align:center; color:#666; }
</style>
</head>
<body>

<header>
<label for="url">Choose site:</label>
<select id="url">
  <option value="compendium">compendiumofeverything.org</option>
  <option value="example">example.com</option>
  <option value="youtube">YouTube Embed</option>
  <option value="pornhubA">Pornhub Embed (Option A)</option>
  <option value="pornhubB">Pornhub Embed (Option B)</option>
</select>
<label for="videoId" id="vidLabel" style="display:none;">Video ID / Viewkey:</label>
<input type="text" id="videoId" style="display:none;" placeholder="e.g. dQw4w9WgXcQ or 686b93f2c3e3d">
<button id="load">Load</button>
<button id="open">Open in new tab</button>
</header>

<div id="frameWrap">
  <div id="blockedMsg" class="message" style="display:none;">
    This site could not be embedded.<br>Click 'Open in new tab' to view it directly.
  </div>
  <iframe id="viewer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<script>
const sel = document.getElementById('url');
const videoInput = document.getElementById('videoId');
const vidLabel = document.getElementById('vidLabel');
const btn = document.getElementById('load');
const openBtn = document.getElementById('open');
const iframe = document.getElementById('viewer');
const blockedMsg = document.getElementById('blockedMsg');

function updateInputs() {
  if (['youtube','pornhubA','pornhubB'].includes(sel.value)) {
    videoInput.style.display = '';
    vidLabel.style.display = '';
  } else {
    videoInput.style.display = 'none';
    vidLabel.style.display = 'none';
  }
}

function loadSite() {
  blockedMsg.style.display = 'none';
  const key = sel.value;
  const path = videoInput.value.trim();
  if (['youtube','pornhubA','pornhubB'].includes(key) && !path) {
    alert('Please enter a video ID / viewkey.');
    return;
  }
  iframe.src = `/api/proxy?url=${key}&path=${encodeURIComponent(path)}`;

  iframe.onload = () => {
    try {
      if (iframe.contentWindow.location.href === 'about:blank') {
        blockedMsg.style.display = 'flex';
      }
    } catch(e) {
      blockedMsg.style.display = 'none';
    }
  };
}

sel.addEventListener('change', updateInputs);
btn.addEventListener('click', loadSite);

openBtn.addEventListener('click', () => {
  const key = sel.value;
  const path = videoInput.value.trim();
  const urlMap = {
    'compendium': 'https://compendiumofeverything.org',
    'example': 'https://example.com'
  };
  if (key === 'youtube') {
    window.open(`https://www.youtube.com/embed/${path}`, '_blank', 'noopener');
  } else if (key === 'pornhubA') {
    window.open(`https://www.pornhub.com/embed/${path}`, '_blank', 'noopener');
  } else if (key === 'pornhubB') {
    window.open(`https://www.pornhub.com/embed/view_video.php?viewkey=${encodeURIComponent(path)}`, '_blank', 'noopener');
  } else {
    window.open(urlMap[key], '_blank', 'noopener');
  }
});

// initial load
updateInputs();
loadSite();
</script>

</body>
</html>
